#include <platform.h>
#include <sound_engine.h>

#pragma bank 1

void loopSound()
{
	if (++soundState.counter == 4)
	{
		soundState.counter = 0;
		if (soundState.isPlaying)
			timerSoundProc();
	}
}

extern const uint8_t* const sounds[];

void playSound(soundType sound)
{
	uint8_t* soundPtr = sounds[sound];
	uint8_t channel = *soundPtr++;
	soundState.data[channel] = soundPtr;
	soundState.isPlaying |= (1 << channel);
}

const uint8_t sinewave[16] = { 0x89, 0xbc, 0xde, 0xff, 0xff, 0xfe, 0xdb, 0xa8, 0x75, 0x42, 0x10, 0x00, 0x00, 0x12, 0x34, 0x67 };
const uint8_t sinewavex2[16] = { 0x8b, 0xdf, 0xfe, 0xc9, 0x63, 0x10, 0x02, 0x47, 0xbd, 0xff, 0xec, 0x96, 0x31, 0x00, 0x24, 0x7b };
const uint8_t randwave[16] = { 0x13, 0x08, 0xd2, 0x53, 0xa1, 0xa0, 0x4f, 0x4c, 0x99, 0xbc, 0xe8, 0x7f, 0x62, 0xe7, 0x5b, 0xd6 };
const uint8_t sawtoothwave[16] = { 0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef, 0x01, 0x23, 0x45, 0x67, 0x89, 0xab, 0xcd, 0xef };
const uint8_t sawtoothwave2[16] = { 0x02, 0x46, 0x8a, 0xce, 0x02, 0x46, 0x8a, 0xce, 0x02, 0x46, 0x8a, 0xce, 0x02, 0x46, 0x8a, 0xce, };
const uint8_t single[16] = { 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

void initSound()
{
	for (uint8_t x = 0; x < 16; x++)
	{
		_AUD3WAVERAM[x] = single[x];
	}
	soundState.isPlaying = 0;
	soundState.counter = 0;
	rAUDENA = AUDENA_ON;
	rAUDVOL = 0x77;
	rAUDTERM = 0xFF;
}